// script.js
// English multiple-choice practice app
// Data: 500 word entries (en, th). The list is ordered from common -> less common to help difficulty tiers.

const WORDS = [
  // 1-50 (very common)
  {en:"apple", th:"แอปเปิล; ผลไม้"},
  {en:"book", th:"หนังสือ"},
  {en:"cat", th:"แมว"},
  {en:"dog", th:"สุนัข"},
  {en:"food", th:"อาหาร"},
  {en:"water", th:"น้ำ"},
  {en:"house", th:"บ้าน"},
  {en:"car", th:"รถยนต์"},
  {en:"school", th:"โรงเรียน"},
  {en:"teacher", th:"ครู"},
  {en:"student", th:"นักเรียน"},
  {en:"table", th:"โต๊ะ"},
  {en:"chair", th:"เก้าอี้"},
  {en:"pen", th:"ปากกา"},
  {en:"pencil", th:"ดินสอ"},
  {en:"phone", th:"โทรศัพท์"},
  {en:"computer", th:"คอมพิวเตอร์"},
  {en:"friend", th:"เพื่อน"},
  {en:"family", th:"ครอบครัว"},
  {en:"baby", th:"ทารก"},
  {en:"mother", th:"แม่"},
  {en:"father", th:"พ่อ"},
  {en:"bread", th:"ขนมปัง"},
  {en:"rice", th:"ข้าว"},
  {en:"egg", th:"ไข่"},
  {en:"milk", th:"นม"},
  {en:"sleep", th:"หลับ"},
  {en:"walk", th:"เดิน"},
  {en:"run", th:"วิ่ง"},
  {en:"eat", th:"กิน"},
  {en:"drink", th:"ดื่ม"},
  {en:"sit", th:"นั่ง"},
  {en:"stand", th:"ยืน"},
  {en:"love", th:"รัก"},
  {en:"happy", th:"มีความสุข"},
  {en:"sad", th:"เศร้า"},
  {en:"hot", th:"ร้อน"},
  {en:"cold", th:"หนาว"},
  {en:"day", th:"วัน"},
  {en:"night", th:"กลางคืน"},
  {en:"sun", th:"พระอาทิตย์"},
  {en:"moon", th:"พระจันทร์"},
  {en:"city", th:"เมือง"},
  {en:"country", th:"ประเทศ"},
  {en:"shop", th:"ร้านค้า"},
  {en:"market", th:"ตลาด"},
  {en:"work", th:"ทำงาน"},
  {en:"play", th:"เล่น"},

  // 51-150 (common everyday)
  {en:"window", th:"หน้าต่าง"},
  {en:"door", th:"ประตู"},
  {en:"floor", th:"พื้น"},
  {en:"ceiling", th:"เพดาน"},
  {en:"kitchen", th:"ห้องครัว"},
  {en:"garden", th:"สวน"},
  {en:"park", th:"สวนสาธารณะ"},
  {en:"bus", th:"รถเมล์"},
  {en:"train", th:"รถไฟ"},
  {en:"plane", th:"เครื่องบิน"},
  {en:"ticket", th:"ตั๋ว"},
  {en:"money", th:"เงิน"},
  {en:"shopper", th:"ผู้ซื้อ"},
  {en:"doctor", th:"แพทย์"},
  {en:"hospital", th:"โรงพยาบาล"},
  {en:"medicine", th:"ยา"},
  {en:"bank", th:"ธนาคาร"},
  {en:"library", th:"ห้องสมุด"},
  {en:"movie", th:"ภาพยนตร์"},
  {en:"music", th:"เพลง"},
  {en:"song", th:"เพลง"},
  {en:"dance", th:"เต้น"},
  {en:"sport", th:"กีฬา"},
  {en:"football", th:"ฟุตบอล"},
  {en:"basketball", th:"บาสเกตบอล"},
  {en:"swim", th:"ว่ายน้ำ"},
  {en:"walkway", th:"ทางเดิน"},
  {en:"road", th:"ถนน"},
  {en:"bridge", th:"สะพาน"},
  {en:"river", th:"แม่น้ำ"},
  {en:"sea", th:"ทะเล"},
  {en:"mountain", th:"ภูเขา"},
  {en:"island", th:"เกาะ"},
  {en:"weather", th:"สภาพอากาศ"},
  {en:"rain", th:"ฝน"},
  {en:"storm", th:"พายุ"},
  {en:"cloud", th:"เมฆ"},
  {en:"wind", th:"ลม"},
  {en:"temperature", th:"อุณหภูมิ"},
  {en:"clock", th:"นาฬิกา"},
  {en:"time", th:"เวลา"},
  {en:"minute", th:"นาที"},
  {en:"hour", th:"ชั่วโมง"},
  {en:"week", th:"สัปดาห์"},
  {en:"month", th:"เดือน"},
  {en:"year", th:"ปี"},
  {en:"holiday", th:"วันหยุด"},
  {en:"festival", th:"เทศกาล"},
  {en:"party", th:"งานเลี้ยง"},
  {en:"gift", th:"ของขวัญ"},
  {en:"present", th:"ของขวัญ"},
  {en:"holiday", th:"วันหยุด (ซ้ำได้เป็นคำอธิบาย)"},
  {en:"ticket", th:"ตั๋ว (ซ้ำ)"},
  {en:"camera", th:"กล้อง"},
  {en:"photo", th:"ภาพถ่าย"},
  {en:"picture", th:"ภาพ"},
  {en:"idea", th:"ความคิด"},
  {en:"problem", th:"ปัญหา"},
  {en:"solution", th:"ทางแก้"},
  {en:"question", th:"คำถาม"},
  {en:"answer", th:"คำตอบ"},
  {en:"information", th:"ข้อมูล"},
  {en:"news", th:"ข่าว"},
  {en:"email", th:"อีเมล"},
  {en:"message", th:"ข้อความ"},
  {en:"letter", th:"จดหมาย"},
  {en:"note", th:"บันทึก"},
  {en:"map", th:"แผนที่"},
  {en:"direction", th:"ทิศทาง"},
  {en:"distance", th:"ระยะทาง"},
  {en:"speed", th:"ความเร็ว"},
  {en:"weight", th:"น้ำหนัก"},
  {en:"size", th:"ขนาด"},
  {en:"height", th:"ความสูง"},
  {en:"width", th:"ความกว้าง"},
  {en:"depth", th:"ความลึก"},
  {en:"color", th:"สี"},
  {en:"shape", th:"รูปร่าง"},
  {en:"texture", th:"พื้นผิว"},
  {en:"material", th:"วัสดุ"},

  // 151-300 (less basic; verbs/nouns/adjectives)
  {en:"accept", th:"ยอมรับ"},
  {en:"achieve", th:"ประสบความสำเร็จ"},
  {en:"act", th:"กระทำ"},
  {en:"add", th:"เพิ่ม"},
  {en:"allow", th:"อนุญาต"},
  {en:"apply", th:"สมัคร / ประยุกต์"},
  {en:"arrive", th:"มาถึง"},
  {en:"ask", th:"ถาม"},
  {en:"believe", th:"เชื่อ"},
  {en:"build", th:"สร้าง"},
  {en:"buy", th:"ซื้อ"},
  {en:"call", th:"โทร / เรียก"},
  {en:"change", th:"เปลี่ยน"},
  {en:"choose", th:"เลือก"},
  {en:"clean", th:"ทำความสะอาด"},
  {en:"close", th:"ปิด"},
  {en:"compare", th:"เปรียบเทียบ"},
  {en:"continue", th:"ต่อเนื่อง"},
  {en:"create", th:"สร้าง"},
  {en:"decide", th:"ตัดสินใจ"},
  {en:"discover", th:"ค้นพบ"},
  {en:"drive", th:"ขับรถ"},
  {en:"enjoy", th:"เพลิดเพลิน"},
  {en:"explain", th:"อธิบาย"},
  {en:"extend", th:"ขยาย"},
  {en:"fix", th:"ซ่อม"},
  {en:"follow", th:"ตาม"},
  {en:"forget", th:"ลืม"},
  {en:"help", th:"ช่วย"},
  {en:"hold", th:"ถือไว้"},
  {en:"include", th:"รวมถึง"},
  {en:"intend", th:"ตั้งใจ"},
  {en:"learn", th:"เรียนรู้"},
  {en:"listen", th:"ฟัง"},
  {en:"lose", th:"เสีย / สูญเสีย"},
  {en:"manage", th:"จัดการ"},
  {en:"move", th:"ย้าย"},
  {en:"open", th:"เปิด"},
  {en:"offer", th:"เสนอ"},
  {en:"organize", th:"จัดระเบียบ"},
  {en:"pay", th:"จ่าย"},
  {en:"perform", th:"แสดง / ปฏิบัติ"},
  {en:"produce", th:"ผลิต"},
  {en:"protect", th:"ปกป้อง"},
  {en:"provide", th:"ให้"},
  {en:"reach", th:"เข้าถึง"},
  {en:"receive", th:"ได้รับ"},
  {en:"reflect", th:"สะท้อน"},
  {en:"remain", th:"ยังคงอยู่"},
  {en:"require", th:"ต้องการ"},
  {en:"respond", th:"ตอบ"},
  {en:"result", th:"ผลลัพธ์"},
  {en:"search", th:"ค้นหา"},
  {en:"sell", th:"ขาย"},
  {en:"share", th:"แบ่งปัน"},
  {en:"support", th:"สนับสนุน"},
  {en:"suggest", th:"แนะนำ"},
  {en:"teach", th:"สอน"},
  {en:"travel", th:"เดินทาง"},
  {en:"understand", th:"เข้าใจ"},
  {en:"visit", th:"เยี่ยมชม"},
  {en:"win", th:"ชนะ"},
  {en:"wish", th:"ปรารถนา"},
  {en:"write", th:"เขียน"},
  {en:"career", th:"อาชีพ"},
  {en:"business", th:"ธุรกิจ"},
  {en:"company", th:"บริษัท"},
  {en:"project", th:"โครงการ"},
  {en:"industry", th:"อุตสาหกรรม"},
  {en:"market", th:"ตลาด (ซ้ำได้)"},
  {en:"customer", th:"ลูกค้า"},
  {en:"service", th:"บริการ"},
  {en:"price", th:"ราคา"},
  {en:"cost", th:"ต้นทุน"},
  {en:"profit", th:"กำไร"},
  {en:"loss", th:"ขาดทุน"},
  {en:"policy", th:"นโยบาย"},
  {en:"strategy", th:"ยุทธศาสตร์"},
  {en:"budget", th:"งบประมาณ"},
  {en:"resource", th:"ทรัพยากร"},
  {en:"skill", th:"ทักษะ"},
  {en:"quality", th:"คุณภาพ"},
  {en:"option", th:"ตัวเลือก"},
  {en:"feature", th:"คุณสมบัติ"},
  {en:"function", th:"ฟังก์ชัน"},

  // 301-400 (more advanced / academic / abstract)
  {en:"abstract", th:"นามธรรม"},
  {en:"analysis", th:"การวิเคราะห์"},
  {en:"approach", th:"แนวทาง"},
  {en:"area", th:"พื้นที่ / บริเวณ"},
  {en:"aspect", th:"ด้าน"},
  {en:"assume", th:"สันนิษฐาน"},
  {en:"authority", th:"อำนาจ"},
  {en:"available", th:"มีให้"},
  {en:"capacity", th:"ความสามารถ / ความจุ"},
  {en:"challenge", th:"ความท้าทาย"},
  {en:"circumstance", th:"สถานการณ์"},
  {en:"component", th:"ส่วนประกอบ"},
  {en:"consequence", th:"ผลที่ตามมา"},
  {en:"construct", th:"ก่อสร้าง / สร้างขึ้น"},
  {en:"context", th:"บริบท"},
  {en:"contract", th:"สัญญา"},
  {en:"create", th:"สร้าง (ซ้ำ)"},
  {en:"data", th:"ข้อมูล"},
  {en:"definition", th:"คำนิยาม"},
  {en:"design", th:"การออกแบบ"},
  {en:"distribution", th:"การกระจาย"},
  {en:"economy", th:"เศรษฐกิจ"},
  {en:"environment", th:"สิ่งแวดล้อม"},
  {en:"establish", th:"สถาปนา / ก่อตั้ง"},
  {en:"evaluate", th:"ประเมิน"},
  {en:"evidence", th:"หลักฐาน"},
  {en:"factor", th:"ปัจจัย"},
  {en:"interpret", th:"ตีความ"},
  {en:"issue", th:"ประเด็น"},
  {en:"method", th:"วิธีการ"},
  {en:"process", th:"กระบวนการ"},
  {en:"range", th:"ช่วง"},
  {en:"role", th:"บทบาท"},
  {en:"sector", th:"ภาคส่วน"},
  {en:"significant", th:"สำคัญ"},
  {en:"source", th:"แหล่ง"},
  {en:"structure", th:"โครงสร้าง"},
  {en:"theory", th:"ทฤษฎี"},
  {en:"variable", th:"ตัวแปร"},
  {en:"volume", th:"ปริมาณ"},
  {en:"version", th:"เวอร์ชัน"},
  {en:"via", th:"ผ่านทาง"},
  {en:"welfare", th:"สวัสดิการ"},
  {en:"whereas", th:"ในขณะที่"},
  {en:"wherever", th:"ทุกที่ที่"},
  {en:"whether", th:"หรือไม่"},
  {en:"where", th:"ที่ไหน"},
  {en:"whenever", th:"เมื่อไรก็ตาม"},
  {en:"whom", th:"ใคร (กรรม)"},
  {en:"whose", th:"ของใคร"},

  // 401-500 (challenging / advanced vocabulary)
  {en:"abundant", th:"อุดมสมบูรณ์"},
  {en:"benevolent", th:"มีเมตตา"},
  {en:"coherent", th:"สอดคล้อง"},
  {en:"detrimental", th:"เป็นอันตราย"},
  {en:"elaborate", th:"ซับซ้อน/อธิบายละเอียด"},
  {en:"feasible", th:"เป็นไปได้"},
  {en:"gregarious", th:"ชอบเข้าสังคม"},
  {en:"heterogeneous", th:"หลากหลาย"},
  {en:"imperative", th:"สำคัญเร่งด่วน"},
  {en:"juxtapose", th:"วางชิดกันเพื่อเปรียบเทียบ"},
  {en:"kinetic", th:"เกี่ยวกับการเคลื่อนไหว"},
  {en:"lucrative", th:"มีกำไร"},
  {en:"meticulous", th:"พิถีพิถัน"},
  {en:"nuance", th:"นัย / ความแตกต่างเล็กน้อย"},
  {en:"obsolete", th:"ล้าสมัย"},
  {en:"plausible", th:"มีความเป็นไปได้"},
  {en:"quintessential", th:"เป็นแบบฉบับที่สำคัญ"},
  {en:"resilient", th:"ยืดหยุ่น, ให้ฟื้นตัวได้ง่าย"},
  {en:"substantiate", th:"พิสูจน์ให้เป็นจริง"},
  {en:"tenacious", th:"แน่วแน่"},
  {en:"ubiquitous", th:"แพร่หลาย"},
  {en:"validate", th:"ตรวจสอบความถูกต้อง"},
  {en:"whimsical", th:"แปลกประหลาด, ชอบเล่นสนุก"},
  {en:"xenophobia", th:"ความกลัวคนต่างชาติ"},
  {en:"yielding", th:"ยอม / ให้ผล"},
  {en:"zealous", th:"กระตือรือร้น"},
  {en:"ambiguous", th:"กำกวม"},
  {en:"bolster", th:"สนับสนุน"},
  {en:"concur", th:"เห็นด้วย"},
  {en:"deleterious", th:"เป็นอันตราย"},
  {en:"exacerbate", th:"ทำให้แย่ลง"},
  {en:"facilitate", th:"อำนวยความสะดวก"},
  {en:"galvanize", th:"กระตุ้น"},
  {en:"harbinger", th:"คำบอกเหตุ / สิ่งบ่งชี้"},
  {en:"impeccable", th:"ไม่มีที่ติ"},
  {en:"jubilant", th:"ชื่นชมยินดี"},
  {en:"kudos", th:"คำชมเชย"},
  {en:"lament", th:"คร่ำครวญ"},
  {en:"malleable", th:"ดัดแปลงได้"},
  {en:"negligible", th:"เล็กน้อยจนมองข้ามได้"},
  {en:"ostentatious", th:"โอ้อวด"},
  {en:"pragmatic", th:"เชิงปฏิบัติ"},
  {en:"quantify", th:"วัดเชิงปริมาณ"},
  {en:"ramification", th:"ผลที่ตามมา"},
  {en:"salient", th:"โดดเด่น"},
  {en:"tantamount", th:"เท่ากับ"},
  {en:"validate", th:"ตรวจสอบ (ซ้ำ)"},
  {en:"wane", th:"ลดลง"},
  {en:"yearn", th:"โหยหา"},
  {en:"zenith", th:"จุดสูงสุด"}
];

// RANKS: 5 ranks (0..4)
const RANKS = [
  {id:0, name:"Novice", minPct:0, desc:"คำพื้นฐานมาก"},
  {id:1, name:"Beginner", minPct:60, desc:"เริ่มมีความท้าทาย"},
  {id:2, name:"Intermediate", minPct:70, desc:"ระดับกลาง ต้องมีความเข้าใจมากขึ้น"},
  {id:3, name:"Advanced", minPct:80, desc:"คำยากขึ้น ตัวเลือกคล้ายกัน"},
  {id:4, name:"Master", minPct:90, desc:"คำยากและเฉพาะทาง"}
];

// Helper: DOM
const $ = (id) => document.getElementById(id);
const startBtn = $("startBtn");
const shuffleBtn = $("shuffleBtn");
const roundSizeSel = $("roundSize");
const startRankSel = $("startRank");
const statsEl = $("stats");
const currentRankEl = $("currentRank");
const playedEl = $("played");
const bestScoreEl = $("bestScore");

const gameEl = $("game");
const thaiWordEl = $("thaiWord");
const choicesEl = $("choices");
const qIndexEl = $("qIndex");
const qBarEl = $("qBar");
const feedbackEl = $("feedback");
const skipBtn = $("skipBtn");
const endBtn = $("endBtn");

const resultEl = $("result");
const scorePctEl = $("scorePct");
const resultRankEl = $("resultRank");
const wrongListEl = $("wrongList");
const againBtn = $("againBtn");
const homeBtn = $("homeBtn");

// State
let state = {
  rank: Number(localStorage.getItem("ep_rank") || 1), // default Beginner
  played: Number(localStorage.getItem("ep_played") || 0),
  best: Number(localStorage.getItem("ep_best") || 0),
};

function saveState(){
  localStorage.setItem("ep_rank", state.rank);
  localStorage.setItem("ep_played", state.played);
  localStorage.setItem("ep_best", state.best);
}

function updateStatsUI(){
  currentRankEl.textContent = RANKS[state.rank].name;
  playedEl.textContent = state.played;
  bestScoreEl.textContent = state.best + "%";
}
updateStatsUI();

// Utility: shuffle
function shuffle(arr){ return arr.map(a=>({r:Math.random(),v:a})).sort((a,b)=>a.r-b.r).map(x=>x.v); }

// Difficulty segmentation
// We'll split WORDS into 5 buckets by index range roughly.
const bucketSize = Math.ceil(WORDS.length / RANKS.length);
const BUCKETS = RANKS.map((r, i) => WORDS.slice(i*bucketSize, (i+1)*bucketSize));

// Build a quiz according to current rank and requested roundSize
function buildQuiz(roundSize, rank){
  // For variety, pick from current rank bucket and some from lower/higher depending on rank.
  let pool = [];
  // Always include some from current bucket:
  const cur = BUCKETS[rank] || [];
  pool = pool.concat(cur);
  // Add neighbors
  if(rank>0) pool = pool.concat(BUCKETS[rank-1] || []);
  if(rank < BUCKETS.length-1) pool = pool.concat(BUCKETS[rank+1] || []);
  // Fallback to full list
  if(pool.length < roundSize) pool = pool.concat(WORDS);
  const chosen = shuffle(pool).slice(0, roundSize);
  // For each chosen, assemble choices: correct + 3 distractors.
  return chosen.map(item => {
    // distractors: prefer same bucket or same starting letter
    const sameBucket = (BUCKETS.find(b => b.includes(item)) || WORDS);
    // pick candidates excluding the item
    const candidates = shuffle(sameBucket.filter(w => w.en !== item.en));
    // if not enough, pull from full list
    while(candidates.length < 3){
      const extra = shuffle(WORDS.filter(w=> w.en !== item.en && !candidates.includes(w)));
      candidates.push(...extra);
    }
    // pick 3 distractors that may be similar (take first letters)
    // Try to pick words starting with same first letter to increase similarity
    const first = item.en[0];
    let candidatesSimilar = candidates.filter(c => c.en[0] === first).slice(0,3);
    if(candidatesSimilar.length < 3){
      // fill with other candidates
      candidatesSimilar = candidatesSimilar.concat(candidates.filter(c => c.en[0] !== first).slice(0, 3 - candidatesSimilar.length));
    }
    const choices = shuffle([item, ...candidatesSimilar.slice(0,3)]);
    return {
      q: item, // {en, th}
      choices: choices.map(c => c.en)
    };
  });
}

// Game runtime variables
let quiz = [];
let qPos = 0;
let correctCount = 0;
let wrongAnswers = [];

// Start button
startBtn.addEventListener("click", () => {
  const roundSize = Number(roundSizeSel.value);
  const startRank = Number(startRankSel.value);
  state.rank = startRank;
  startRound(roundSize);
});

// Shuffle library (reshuffle vocabulary) - for variety, just shuffle WORDS array order (non-destructive)
shuffleBtn.addEventListener("click", () => {
  for(let i=0;i<3;i++) shuffle(WORDS);
  alert("สุ่มชุดคำศัพท์เรียบร้อยแล้ว");
});

// Start round
function startRound(roundSize){
  quiz = buildQuiz(roundSize, state.rank);
  qPos = 0; correctCount = 0; wrongAnswers = [];
  // show game UI
  document.querySelectorAll(".panel").forEach(p => p.classList.add("hidden"));
  gameEl.classList.remove("hidden");
  renderQuestion();
}

function renderQuestion(){
  const q = quiz[qPos];
  qIndexEl.textContent = `${qPos+1} / ${quiz.length}`;
  qBarEl.style.width = `${Math.round(((qPos)/quiz.length)*100)}%`;
  thaiWordEl.textContent = q.q.th;
  choicesEl.innerHTML = "";
  q.choices.forEach(choice => {
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    btn.textContent = choice;
    btn.onclick = () => handleChoice(btn, choice);
    choicesEl.appendChild(btn);
  });
  feedbackEl.textContent = "";
}

function handleChoice(btn, selected){
  const q = quiz[qPos];
  // disable further clicks
  Array.from(choicesEl.children).forEach(b => b.disabled = true);
  if(selected === q.q.en){
    btn.classList.add("correct");
    feedbackEl.textContent = "ถูกต้อง!";
    correctCount++;
  } else {
    btn.classList.add("wrong");
    feedbackEl.textContent = `ผิด — คำตอบที่ถูกต้องคือ: ${q.q.en}`;
    wrongAnswers.push({q:q.q, selected});
    // highlight correct button
    Array.from(choicesEl.children).forEach(b => {
      if(b.textContent === q.q.en) b.classList.add("correct");
    });
  }
  // next question after short delay
  setTimeout(() => {
    qPos++;
    if(qPos < quiz.length) renderQuestion();
    else finishRound();
  }, 800);
}

skipBtn.addEventListener("click", () => {
  // count as wrong (optional) — we'll just advance without marking correct
  wrongAnswers.push({q:quiz[qPos].q, selected:null});
  qPos++;
  if(qPos < quiz.length) renderQuestion();
  else finishRound();
});

endBtn.addEventListener("click", () => {
  if(confirm("ต้องการจบเกมก่อนเวลา?")) finishRound();
});

// Finish
function finishRound(){
  // stats
  const pct = Math.round((correctCount / quiz.length)*100);
  // update state played, best
  state.played++;
  if(pct > state.best) state.best = pct;
  // determine rank up or down:
  // If pct >= threshold for next rank, increase by 1
  // If pct < threshold for current rank minus 10, decrease by 1 (floor 0)
  const curRank = state.rank;
  let newRank = curRank;
  // Promote rules: if pct >= threshold for rank+1 (and rank < max) promote
  if(curRank < RANKS.length-1){
    const nextReq = RANKS[curRank+1].minPct;
    if(pct >= nextReq) newRank = curRank + 1;
  }
  // Demote rules: if pct < RANKS[curRank].minPct - 10, demote one
  if(curRank > 0){
    if(pct < Math.max(0, RANKS[curRank].minPct - 10)) newRank = curRank - 1;
  }
  state.rank = newRank;
  saveState();
  // show result screen
  document.querySelectorAll(".panel").forEach(p => p.classList.add("hidden"));
  resultEl.classList.remove("hidden");
  scorePctEl.textContent = pct + "%";
  resultRankEl.textContent = RANKS[state.rank].name;
  wrongListEl.innerHTML = "";
  if(wrongAnswers.length === 0){
    const li = document.createElement("li");
    li.textContent = "ไม่มีคำตอบผิด — เยี่ยม!";
    wrongListEl.appendChild(li);
  } else {
    wrongAnswers.forEach(w => {
      const li = document.createElement("li");
      if(w.selected) li.textContent = `${w.q.th} — ถูกต้อง: ${w.q.en} (คุณเลือก: ${w.selected})`;
      else li.textContent = `${w.q.th} — ถูกต้อง: ${w.q.en} (คุณข้าม)`;
      wrongListEl.appendChild(li);
    });
  }
  // update stats UI
  updateStatsUI();
}

// replay & home
againBtn.addEventListener("click", () => {
  const roundSize = Number(roundSizeSel.value);
  startRound(roundSize);
});
homeBtn.addEventListener("click", () => {
  document.querySelectorAll(".panel").forEach(p => p.classList.add("hidden"));
  document.querySelector(".settings").classList.remove("hidden");
  statsEl.classList.remove("hidden");
  updateStatsUI();
});

// initialize UI: show settings panel
(function init(){
  document.querySelectorAll(".panel").forEach(p => p.classList.add("hidden"));
  document.querySelector(".settings").classList.remove("hidden");
  statsEl.classList.remove("hidden");
  currentRankEl.textContent = RANKS[state.rank].name;
})();


